{
    "bookmarked": false,
    "bookmarked_total": 0,
    "change_logs": [],
    "content": "# Lines of code\n\nhttps://github.com/jbx-protocol/juice-contracts-v2-code4rena/blob/828bf2f3e719873daa08081cfa0d0a6deaa5ace5/contracts/JBSplitsStore.sol#L211-L221\n\n\n# Vulnerability details\n\n## Impact\n\n**MED** - the function of the protocol could be impacted\n\n## Proof of Concept\n\n- [proof of concept](https://gist.github.com/zzzitron/a8c6067923a87af8e001c05442258370#file-2022-07-juiceboxv2-t-sol-L117-L163)\n\nThe proof of concept demonstrates to discard one of  duplicated locked splits. In the beginning it launches a project with two identical locked splits. As the owner of the project, it updates splits to only one of the two splits. Since all of original splits are locked both of them should still in the split after the update, but only one of them exists in the updated splits.\n\nIt happens because [the check of the locked split](https://github.com/jbx-protocol/juice-contracts-v2-code4rena/blob/828bf2f3e719873daa08081cfa0d0a6deaa5ace5/contracts/JBSplitsStore.sol#L211-L221) is not suitable for duplicated cases.\n\n```solidity\n// JBSplitsStore::_set\n\n203    // Check to see if all locked splits are included.\n204    for (uint256 _i = 0; _i < _currentSplits.length; _i++) {\n205      // If not locked, continue.\n206      if (block.timestamp >= _currentSplits[_i].lockedUntil) continue;\n207\n208      // Keep a reference to whether or not the locked split being iterated on is included.\n209      bool _includesLocked = false;\n210\n211      for (uint256 _j = 0; _j < _splits.length; _j++) {\n212        // Check for sameness.\n213        if (\n214          _splits[_j].percent == _currentSplits[_i].percent &&\n215          _splits[_j].beneficiary == _currentSplits[_i].beneficiary &&\n216          _splits[_j].allocator == _currentSplits[_i].allocator &&\n217          _splits[_j].projectId == _currentSplits[_i].projectId &&\n218          // Allow lock extention.\n219          _splits[_j].lockedUntil >= _currentSplits[_i].lockedUntil\n220        ) _includesLocked = true;\n221      }\n222\n223      if (!_includesLocked) revert PREVIOUS_LOCKED_SPLITS_NOT_INCLUDED();\n224    }\n```\n\n\n## Tools Used\n\nNone\n\n## Recommended Mitigation Steps\n\nEither prevent duplicates in the splits or track the matches while checking the locked splits.\n\n\n\n\n",
    "contest_link": "https://code4rena.com/contests/2022-07-juicebox-v2-contest",
    "contest_prize_txt": "$75,000 USDC",
    "editor_comments": [],
    "finder_list": [
        "zzzitron"
    ],
    "finders_count": 1,
    "general_score": 0.0,
    "github_dicussion_no": 3717,
    "github_link": "https://github.com/code-423n4/2022-07-juicebox-findings/issues/219",
    "id": 2959,
    "impact": "MEDIUM",
    "issue_protocol": {
        "category_list": [
            {
                "description": "Protocols that enable you to earn staking rewards on your tokens while also providing a tradeable and liquid receipt for your staked position",
                "title": "Liquid Staking"
            },
            {
                "description": "Protocols where you can swap/trade cryptocurrency",
                "title": "Dexes"
            },
            {
                "description": "Protocols that bridge tokens from one network to another",
                "title": "Bridge"
            },
            {
                "description": "Protocols that mint its own stablecoin using collateralized lending",
                "title": "CDP"
            },
            {
                "description": "Protocols that pay you a reward for your staking/LP on their platform",
                "title": "Yield"
            }
        ],
        "id": 189,
        "name": "Juicebox"
    },
    "issue_source": {
        "has_contest": true,
        "logo_horizontal_url": "https://solodit-bucket.s3.amazonaws.com/storage/images/af_logos/code4rena_horizontal.png",
        "logo_square_url": "https://solodit-bucket.s3.amazonaws.com/storage/images/af_logos/code4rena_square.png",
        "name": "Code4rena",
        "url": "https://code4rena.com"
    },
    "kind": "GIT",
    "markasread": false,
    "openai_explained": true,
    "pdf_link": "",
    "pdf_page_from": 0,
    "quality_score": 0.0,
    "report_date": "2022-07-01T20:00:00Z",
    "similar_issue_list": [
        {
            "id": 9561,
            "slug": "possible-loss-of-ownership-halborn-nftfi-bundlesairdrop-pdf",
            "title": "POSSIBLE LOSS OF OWNERSHIP"
        },
        {
            "id": 9612,
            "slug": "possible-loss-of-ownership-halborn-nftfi-directloanfixedoffer-redeployment-pdf",
            "title": "POSSIBLE LOSS OF OWNERSHIP"
        },
        {
            "id": 2973,
            "slug": "m-15-locked-splits-can-be-updated-code4rena-juicebox-juicebox-v2-contest-git",
            "title": "[M-15] Locked splits can be updated"
        }
    ],
    "slug": "m-01-duplicated-locked-splits-can-be-discarded-code4rena-juicebox-juicebox-v2-contest-git",
    "source_link": "https://code4rena.com/reports/2022-07-juicebox",
    "sponsor_name": "Juicebox",
    "summary": "\nThis bug report is about a vulnerability in the function of a protocol. It could have a medium impact on the protocol's functionality. The proof of concept demonstrates that when the owner of a project updates the splits, one of the duplicated locked splits is discarded. This happens because the check of the locked split is not suitable for duplicated cases. No tools were used to identify this vulnerability. To mitigate this issue, it is recommended to either prevent duplicates in the splits or track the matches while checking the locked splits.",
    "tag_list": [],
    "title": "[M-01] Duplicated locked splits can be discarded",
    "user_note": {
        "created_at": null,
        "note": ""
    }
}